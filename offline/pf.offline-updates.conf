# Temporary outbound expansion for maintenance windows
# Loaded into anchor "offline-updates" by offline/offline-firewall.sh
# Tables are populated by sync-pf-tables.sh to avoid DNS resolution at load time
#
# NOTE: Uses $lan_ip (physical interface IP) for WAN egress, not $ts_cidr

# Import macros (wan_if, lan_ip, etc.)
include "/etc/pf.offline.vars"

table <lmstudio_hosts> persist
table <update_hosts> persist
table <package_repos> persist

# Allow DNS during update window for table sync
pass out on $wan_if proto udp from $lan_ip to any port 53 keep state

# HTTPS-only to update sources
pass out on $wan_if proto tcp from $lan_ip to <lmstudio_hosts> port 443 keep state
pass out on $wan_if proto tcp from $lan_ip to <update_hosts>  port 443 keep state
pass out on $wan_if proto tcp from $lan_ip to <package_repos> port 443 keep state
